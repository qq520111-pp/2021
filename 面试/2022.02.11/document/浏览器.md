### 什么是事件循环

事件循环是一种解决`javaScript`单线程运行时不会阻塞的运行机制 ，结合消息队列让整个页面有序执行。

事件循环运行原理：通过模拟一个循环每次去读取消息队列中一个任务并且丢主线程中执行，里面还会维护一个延迟队列用来保存定时器、延时器。这也是为什么定时器会不能准时执行原因，在执行延迟队列时还会处理消息队列中任务。

消息队列任务来源：渲染进程、网络进程、js异步代码、用户交互行为等

![448d71aa675ba0a185ff021adfed58c](E:\桌面\面试\2022.02.11\images\448d71aa675ba0a185ff021adfed58c.png)

### 什么是宏任务、微任务

消息队列中的任务称为宏任务，有script、settimeout、setinterval、setimmediate等

微任务是一个需要异步执行的函数，执行时机是在主函数执行结束之后、当前宏任务结束之前。promise.then、mutationObserve

### 用户输入URL的过程

用户输入URL到页面展示大致分为5步：

* 用户输入URL，判断是否有浏览器缓存
* 解析URL，通过DNS把域名解析成对应IP，会有DNS缓存，解析完成通过IPC传入到网络进程。
* 网络进程构建相关请求信息、发送请求，服务器解析请求并且响应相关数据。（三次握手、http协议、TCP相关知识）
* 浏览器拿到数据，判断是否301、302、304等相关状态码进行重定向和缓存。状态码是200的话就进行content-type的内容类型判断是否问html还是其他类型。如果是HTML把数据丢给渲染进程，在这一步会进行**提交文档**给浏览器主进程去更新对应的安全信息、历史记录、地址栏信息。然后进入渲染阶段.
* 渲染进程通过生成dom、cssom、抽象语法树等进行生成对应位图页面。渲染页面就结束了

> 渲染处理阶段

1. 解析生成dom、cssdom。

2. 计算样式。生成可渲染树。(剔除不可渲染元素)

3. 布局

4. 分层

   以上四个步骤是在浏览器主进程执行的。（重排和重绘会重新到2、3开始执行）

   以下是非主线程中执行。（transfrom动画的时候，直接在非主线程合成效率极高）

5. 为每个图层生成**绘制列表**

6. 合成图块、附近位图

   在渲染进程、合成线程里生成图块。GPU进程里生成位图并且保存在内存中。操作完成会提交一个绘制命令给浏览器。

   **合成线程会按照视口附近的图块来优先生成位图，实际生成位图的操作是由栅格化来执行的。所谓栅格化，是指将图块转换为位图**

7. 合成位图完成，绘制图块的命令——“DrawQuad”

8. 浏览器主线程进行渲染展示页面

### 浏览器缓存

https://juejin.cn/post/7051411987502202917

### 浏览器内核



